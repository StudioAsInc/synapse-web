<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Branch Reverter</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Simple spinner for loading states */
        .loader {
            border: 4px solid #f3f3f3; /* Light grey */
            border-top: 4px solid #3498db; /* Blue */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 2s linear infinite;
            display: inline-block;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-4 font-sans">

    <div class="bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-3xl space-y-6">
        
        <!-- Header -->
        <div class="text-center">
            <h1 class="text-2xl md:text-3xl font-bold text-teal-400">GitHub Branch Reverter</h1>
            <p class="text-gray-400 mt-2">Select a branch and revert it to a previous commit.</p>
        </div>

        <!-- Security Warning -->
        <div class="bg-red-900 border-l-4 border-red-500 text-red-100 p-4 rounded-r-lg" role="alert">
            <p class="font-bold">Warning: Highly Destructive Action!</p>
            <p class="text-sm">Reverting a branch is a "force push" operation that rewrites the branch history. This action is irreversible. Your Personal Access Token (PAT) is handled only in your browser and is not stored or sent anywhere except to GitHub's API.</p>
        </div>

        <!-- Form for Inputs -->
        <form id="repoForm" class="space-y-4">
            <div>
                <label for="pat" class="block text-sm font-medium text-gray-300">GitHub Personal Access Token (PAT)</label>
                <input type="password" id="pat" name="pat" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx" required class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500 p-2">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label for="owner" class="block text-sm font-medium text-gray-300">Repository Owner</label>
                    <input type="text" id="owner" name="owner" placeholder="e.g., octocat" required class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500 p-2">
                </div>
                <div>
                    <label for="repo" class="block text-sm font-medium text-gray-300">Repository Name</label>
                    <input type="text" id="repo" name="repo" placeholder="e.g., Hello-World" required class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500 p-2">
                </div>
                <div>
                    <label for="branch" class="block text-sm font-medium text-gray-300">Branch Name</label>
                    <input type="text" id="branch" name="branch" placeholder="e.g., main" required class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500 p-2">
                </div>
            </div>

            <button type="submit" class="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-2 px-4 rounded-md transition duration-300 flex items-center justify-center">
                Fetch Commits
            </button>
        </form>

        <!-- Status & Feedback Area -->
        <div id="status" class="hidden mt-4 p-3 rounded-md text-center"></div>

        <!-- Commit List Area -->
        <div id="commitListContainer" class="hidden mt-6">
            <h2 class="text-xl font-bold text-teal-400 mb-4">Revert to a Commit</h2>

            <!-- Revert by Specific SHA -->
            <div class="mb-6 p-4 bg-gray-700/50 rounded-md space-y-2 border border-gray-600">
                <label for="specificSha" class="block text-sm font-medium text-gray-300">Revert to a Specific Commit SHA</label>
                <div class="flex flex-col sm:flex-row gap-2">
                    <input type="text" id="specificSha" placeholder="Paste full commit SHA here" class="flex-grow bg-gray-600 border-gray-500 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500 p-2 font-mono text-sm">
                    <button id="revertByShaBtn" class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded text-sm transition duration-300 flex-shrink-0">
                        Revert to this SHA
                    </button>
                </div>
            </div>
            
            <h3 class="text-lg font-semibold text-gray-300 mb-3">Or, select from recent commits:</h3>
            <div id="commitList" class="space-y-3 max-h-80 overflow-y-auto pr-2">
                <!-- Commits will be dynamically inserted here -->
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const repoForm = document.getElementById('repoForm');
            const statusDiv = document.getElementById('status');
            const commitListContainer = document.getElementById('commitListContainer');
            const commitListDiv = document.getElementById('commitList');

            const patInput = document.getElementById('pat');
            const ownerInput = document.getElementById('owner');
            const repoInput = document.getElementById('repo');
            const branchInput = document.getElementById('branch');
            const specificShaInput = document.getElementById('specificSha');
            const revertByShaBtn = document.getElementById('revertByShaBtn');

            // --- Show/Hide Status Helper ---
            function showStatus(message, type = 'info', isLoading = false) {
                statusDiv.innerHTML = ''; // Clear previous content
                if (isLoading) {
                    const loader = document.createElement('div');
                    loader.className = 'loader';
                    statusDiv.appendChild(loader);
                }
                const text = document.createElement('span');
                text.textContent = message;
                statusDiv.appendChild(text);
                
                statusDiv.className = 'mt-4 p-3 rounded-md text-center flex items-center justify-center ';
                switch(type) {
                    case 'error': statusDiv.classList.add('bg-red-900', 'text-red-100'); break;
                    case 'success': statusDiv.classList.add('bg-green-900', 'text-green-100'); break;
                    default: statusDiv.classList.add('bg-blue-900', 'text-blue-100');
                }
                statusDiv.classList.remove('hidden');
            }

            function hideStatus() {
                statusDiv.classList.add('hidden');
            }

            // --- Fetch Commits Logic ---
            repoForm.addEventListener('submit', async (event) => {
                event.preventDefault();
                commitListContainer.classList.add('hidden');
                commitListDiv.innerHTML = '';
                
                const pat = patInput.value.trim();
                const owner = ownerInput.value.trim();
                const repo = repoInput.value.trim();
                const branch = branchInput.value.trim();

                if (!pat || !owner || !repo || !branch) {
                    showStatus('All fields are required.', 'error');
                    return;
                }

                showStatus('Fetching commits...', 'info', true);

                try {
                    const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/commits?sha=${branch}`, {
                        headers: {
                            'Authorization': `Bearer ${pat}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(`GitHub API Error: ${errorData.message || response.statusText}`);
                    }

                    const commits = await response.json();
                    hideStatus();
                    displayCommits(commits);

                } catch (error) {
                    showStatus(`Failed to fetch commits: ${error.message}`, 'error');
                }
            });

            // --- Display Commits in the UI ---
            function displayCommits(commits) {
                if (commits.length === 0) {
                    showStatus('No commits found for this branch.', 'info');
                    return;
                }

                commitListContainer.classList.remove('hidden');
                commits.forEach(commit => {
                    const commitData = commit.commit;
                    const commitSha = commit.sha;

                    const commitElement = document.createElement('div');
                    commitElement.className = 'bg-gray-700 p-4 rounded-md flex flex-col md:flex-row justify-between md:items-center gap-3';
                    
                    const commitInfo = `
                        <div class="flex-grow">
                            <p class="font-mono text-sm text-teal-300">${commitSha.substring(0, 7)}</p>
                            <p class="font-semibold">${commitData.message.split('\n')[0]}</p>
                            <p class="text-xs text-gray-400">by ${commitData.author.name} on ${new Date(commitData.author.date).toLocaleString()}</p>
                        </div>
                    `;
                    
                    const revertButton = `
                        <div>
                            <button data-sha="${commitSha}" class="revert-btn w-full md:w-auto bg-red-600 hover:bg-red-700 text-white font-semibold py-1 px-3 rounded text-xs transition duration-300">
                                Revert to this commit
                            </button>
                        </div>
                    `;

                    commitElement.innerHTML = commitInfo + revertButton;
                    commitListDiv.appendChild(commitElement);
                });
            }
            
            // --- Core Revert Logic (reusable function) ---
            async function revertBranchToSha(commitSha) {
                const branch = branchInput.value.trim();
                const owner = ownerInput.value.trim();
                const repo = repoInput.value.trim();
                const pat = patInput.value.trim();

                if (!commitSha) {
                    showStatus('Commit SHA cannot be empty.', 'error');
                    return;
                }

                const confirmation = confirm(`ARE YOU ABSOLUTELY SURE?\n\nYou are about to revert the '${branch}' branch to commit ${commitSha.substring(0,7)}.\nThis is a destructive action that rewrites history and cannot be easily undone.`);
                
                if (!confirmation) {
                    return;
                }
                
                showStatus('Reverting branch...', 'info', true);

                try {
                    const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/git/refs/heads/${branch}`, {
                        method: 'PATCH',
                        headers: {
                            'Authorization': `Bearer ${pat}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            sha: commitSha,
                            force: true // This is the critical part that performs the hard reset
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(`GitHub API Error: ${errorData.message || response.statusText}`);
                    }

                    showStatus(`Successfully reverted branch '${branch}' to commit ${commitSha.substring(0,7)}! Please refresh your repository page.`, 'success');
                    commitListContainer.classList.add('hidden'); // Hide list after successful revert

                } catch (error) {
                    showStatus(`Failed to revert branch: ${error.message}`, 'error');
                }
            }

            // --- Event Delegation for Revert Buttons in the list ---
            commitListDiv.addEventListener('click', async (event) => {
                if (event.target.classList.contains('revert-btn')) {
                    const commitShaToRevert = event.target.dataset.sha;
                    await revertBranchToSha(commitShaToRevert);
                }
            });
            
            // --- Event Listener for reverting by specific SHA input ---
            revertByShaBtn.addEventListener('click', async (event) => {
                event.preventDefault();
                const specificSha = specificShaInput.value.trim();
                await revertBranchToSha(specificSha);
            });
        });
    </script>

</body>
</html>