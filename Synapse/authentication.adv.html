<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Authentication | Synapse</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #10b981;
      --primary-dark: #059669;
      --primary-light: #a7f3d0;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; filter: blur(5px); }
      to { opacity: 1; filter: blur(0); }
    }
    
    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; filter: blur(5px); }
      to { transform: translateY(0); opacity: 1; filter: blur(0); }
    }
    
    @keyframes scaleIn {
      from { transform: scale(0.95); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }
    
    .animate-float {
      animation: float 6s ease-in-out infinite;
      will-change: transform;
    }
    
    .animate-fade-in {
      animation: fadeIn 0.6s cubic-bezier(0.2, 0, 0.2, 1) forwards;
    }
    
    .animate-slide-up {
      animation: slideUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
      will-change: transform, opacity, filter;
    }
    
    .animate-scale-in {
      animation: scaleIn 0.5s cubic-bezier(0.2, 0, 0.2, 1) forwards;
    }
    
    .animate-pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    
    .card-container {
      perspective: 2000px;
      transform-style: preserve-3d;
    }
    
    .card {
      transform-style: preserve-3d;
      transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
      height: auto;
      position: relative;
      backface-visibility: hidden;
    }
    
    .card-face {
      backface-visibility: hidden;
      position: absolute;
      width: 100%;
      height: 100%;
      transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      transform-origin: center center;
      transform-style: preserve-3d;
    }
    
    .card-front {
      transform: rotateY(0deg);
    }
    
    .card-back {
      transform: rotateY(180deg);
    }
    
    .flipped .card-front {
      transform: rotateY(-180deg);
    }
    
    .flipped .card-back {
      transform: rotateY(0deg);
    }
    
    .swipe-left {
      transform: translateX(-100%) rotateY(-30deg) scale(0.9);
      opacity: 0;
      transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      filter: blur(5px);
    }
    
    .swipe-right {
      transform: translateX(100%) rotateY(30deg) scale(0.9);
      opacity: 0;
      transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      filter: blur(5px);
    }
    
    .height-transition {
      transition: height 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .form-container {
      overflow: hidden;
      will-change: transform;
    }
    
    .input-focus-effect {
      transition: all 0.3s ease;
      box-shadow: 0 0 0 0 rgba(16, 185, 129, 0);
    }
    
    .input-focus-effect:focus {
      box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.3);
    }
    
    .btn-hover-effect {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      transform: translateZ(0);
      backface-visibility: hidden;
    }
    
    .btn-hover-effect:hover {
      transform: translateY(-2px) translateZ(0);
      box-shadow: 0 10px 20px -5px rgba(16, 185, 129, 0.3);
    }
    
    .btn-hover-effect:active {
      transform: translateY(0) translateZ(0);
      box-shadow: 0 5px 10px -3px rgba(16, 185, 129, 0.3);
    }
    
    .bg-glass {
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(50px);
    }
    
    .bg-gradient-radial {
      background: radial-gradient(circle at 50% 0%, rgba(167, 243, 208, 0.2) 0%, rgba(255, 255, 255, 0) 50%);
    }
    
    .floating-dots {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      overflow: hidden;
      z-index: -1;
    }
    
    .floating-dots span {
      position: absolute;
      display: block;
      width: 8px;
      height: 8px;
      background: rgba(16, 185, 129, 0.2);
      border-radius: 50%;
      filter: blur(1px);
      animation: float 15s linear infinite;
      bottom: -150px;
    }
    
    .floating-dots span:nth-child(1) {
      left: 25%;
      width: 10px;
      height: 10px;
      animation-delay: 0s;
      animation-duration: 15s;
    }
    
    .floating-dots span:nth-child(2) {
      left: 10%;
      width: 6px;
      height: 6px;
      animation-delay: 2s;
      animation-duration: 12s;
    }
    
    .floating-dots span:nth-child(3) {
      left: 70%;
      width: 8px;
      height: 8px;
      animation-delay: 4s;
      animation-duration: 18s;
    }
    
    .floating-dots span:nth-child(4) {
      left: 40%;
      width: 12px;
      height: 12px;
      animation-delay: 0s;
      animation-duration: 22s;
    }
    
    .floating-dots span:nth-child(5) {
      left: 65%;
      width: 6px;
      height: 6px;
      animation-delay: 0s;
      animation-duration: 14s;
    }
    
    .floating-dots span:nth-child(6) {
      left: 75%;
      width: 8px;
      height: 8px;
      animation-delay: 3s;
      animation-duration: 16s;
    }
    
    .floating-dots span:nth-child(7) {
      left: 35%;
      width: 10px;
      height: 10px;
      animation-delay: 7s;
      animation-duration: 20s;
    }
    
    .floating-dots span:nth-child(8) {
      left: 50%;
      width: 6px;
      height: 6px;
      animation-delay: 15s;
      animation-duration: 25s;
    }
    
    .ripple {
      position: absolute;
      border-radius: 50%;
      background-color: rgba(255, 255, 255, 0.7);
      transform: scale(0);
      animation: ripple 0.6s linear;
      pointer-events: none;
    }
    
    @keyframes ripple {
      to {
        transform: scale(4);
        opacity: 0;
      }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen flex items-center justify-center p-4 select-none touch-manipulation overflow-hidden">
  <!-- Background elements -->
  <div class="floating-dots">
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
  </div>
  
  <!-- Verification Dialog -->
  <div id="verificationDialog" class="hidden fixed inset-0 z-[9999] bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center p-4 animate-fade-in">
    <div class="bg-glass rounded-2xl p-8 max-w-md w-full animate-scale-in shadow-xl border border-white border-opacity-20">
      <div class="text-center mb-2">
        <div class="w-16 h-16 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4 animate-pulse">
          <i class="fas fa-envelope text-emerald-600 text-2xl"></i>
        </div>
        <h3 class="text-2xl font-bold text-gray-800 mb-2">Verify Your Email</h3>
        <p class="text-gray-600 mb-4">
          We've sent a verification email to
          <span id="sentEmail" class="font-medium text-emerald-600"></span>.
        </p>
        <p class="text-gray-600 mb-6">
          Please check your inbox and verify your email address.
        </p>
        <div class="flex items-center justify-center mb-6">
          <div class="w-full bg-gray-200 rounded-full h-1.5">
            <div id="countdown-bar" class="bg-emerald-600 h-1.5 rounded-full" style="width: 100%"></div>
          </div>
          <span id="countdown" class="ml-3 text-gray-600 font-medium">30</span>
        </div>
      </div>
      <button
        onclick="redirectToSignIn()"
        class="w-full py-3 px-6 bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 text-white font-medium rounded-xl transition-all duration-300 btn-hover-effect relative overflow-hidden"
      >
        Continue
      </button>
    </div>
  </div>

  <!-- Main Authentication Container -->
  <div class="relative w-full max-w-md mx-auto">
    <!-- Navigation Dots -->
    <div class="absolute -bottom-10 left-0 right-0 flex justify-center space-x-3 z-10">
      <button id="dot-signin" onclick="flipToSignIn()" class="w-3 h-3 rounded-full bg-emerald-500 transition-all duration-300 transform hover:scale-125 focus:outline-none"></button>
      <button id="dot-signup" onclick="flipToSignUp()" class="w-3 h-3 rounded-full bg-gray-300 transition-all duration-300 transform hover:scale-125 focus:outline-none"></button>
    </div>

    <!-- Card Container -->
    <div id="cardContainer" class="card-container w-full">
      <div id="authCard" class="card relative w-full height-transition bg-gradient-radial">
        <!-- Sign In Face (Front) -->
        <div id="signInFace" class="card-face card-front bg-glass rounded-3xl shadow-2xl p-8 form-container border border-white border-opacity-20" style="height: auto;">
          <div class="text-center mb-8 animate-slide-up opacity-0">
            <div class="w-14 h-14 bg-emerald-100 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-inner">
              <i class="fas fa-sign-in-alt text-emerald-600 text-xl"></i>
            </div>
            <h2 class="text-3xl font-bold text-gray-800">Welcome back</h2>
            <p class="text-gray-500 mt-2">Sign in to your account</p>
          </div>

          <button
            id="google-btn"
            class="w-full flex items-center justify-center gap-3 py-3 px-6 border border-gray-300 rounded-xl font-medium hover:bg-gray-50 transition-all duration-300 mb-4 btn-hover-effect animate-slide-up opacity-0 relative overflow-hidden"
            onclick="googleLogin()"
          >
            <img src="https://www.svgrepo.com/show/475656/google-color.svg" width="20" alt="Google" class="filter drop-shadow-sm" />
            Continue with Google
          </button>

          <div class="relative my-6 animate-slide-up opacity-0">
            <div class="absolute inset-0 flex items-center">
              <div class="w-full border-t border-gray-200"></div>
            </div>
            <div class="relative flex justify-center text-sm">
              <span class="px-3 bg-white bg-opacity-80 text-gray-500 rounded-full border border-gray-200">or</span>
            </div>
          </div>

          <div class="space-y-4 animate-slide-up opacity-0">
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400">
                <i class="far fa-envelope"></i>
              </div>
              <input
                type="email"
                id="signin-email"
                placeholder="you@example.com"
                class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none transition-all duration-300 input-focus-effect bg-white bg-opacity-70"
                oninput="validateEmailInput(this)"
              />
            </div>

            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400">
                <i class="fas fa-lock"></i>
              </div>
              <input
                type="password"
                id="signin-password"
                placeholder="Password"
                class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none transition-all duration-300 input-focus-effect bg-white bg-opacity-70"
              />
              <button
                type="button"
                class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700 transition-colors duration-200"
                onclick="togglePasswordVisibility('signin')"
              >
                <i id="signin-password-icon" class="fas fa-eye-slash"></i>
              </button>
            </div>

            <div
              class="text-right text-sm text-gray-500 hover:text-gray-700 hover:underline cursor-pointer mb-4 transition-colors duration-200"
              onclick="alert('Reset Password flow goes here')"
            >
              Forgot Password?
            </div>

            <button
              id="login-btn"
              class="w-full py-3 px-6 bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 text-white font-medium rounded-xl transition-all duration-300 btn-hover-effect relative overflow-hidden"
              onclick="login()"
            >
              <span id="login-btn-text">Sign In</span>
              <svg id="login-spinner" class="hidden w-5 h-5 ml-2 text-white animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
            </button>

            <div id="signin-error-message" class="text-red-500 text-sm text-center mt-2 min-h-4"></div>
          </div>

          <div class="text-center text-sm text-gray-500 mt-6 animate-slide-up opacity-0">
            Don't have an account? 
            <button onclick="flipToSignUp()" class="text-emerald-600 font-medium hover:underline focus:outline-none transition-colors duration-200">
              Sign Up Now
            </button>
          </div>
        </div>

        <!-- Sign Up Face (Back) -->
        <div id="signUpFace" class="card-face card-back bg-glass rounded-3xl shadow-2xl p-8 form-container border border-white border-opacity-20" style="height: auto;">
          <div class="text-center mb-6 animate-slide-up opacity-0">
            <div class="w-14 h-14 bg-emerald-100 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-inner">
              <i class="fas fa-user-plus text-emerald-600 text-xl"></i>
            </div>
            <h2 class="text-3xl font-bold text-gray-800">Create Account</h2>
            <p class="text-gray-600 mt-2">Get started with your free account</p>
          </div>

          <button
            class="w-full flex items-center justify-center gap-3 py-3 px-6 border border-gray-300 rounded-xl font-medium hover:bg-gray-50 transition-all duration-300 mb-4 btn-hover-effect animate-slide-up opacity-0 relative overflow-hidden"
            onclick="googleLogin()"
          >
            <img src="https://www.svgrepo.com/show/475656/google-color.svg" width="20" alt="Google" class="filter drop-shadow-sm" />
            Continue with Google
          </button>

          <div class="relative flex items-center my-6 animate-slide-up opacity-0">
            <div class="flex-grow border-t border-gray-300"></div>
            <span class="flex-shrink mx-4 text-gray-400 text-sm">or</span>
            <div class="flex-grow border-t border-gray-300"></div>
          </div>

          <form id="signupForm" class="space-y-4 animate-slide-up opacity-0">
            <div>
              <label for="signup-username" class="block text-sm font-medium text-gray-700 mb-1">Username</label>
              <div class="relative">
                <input
                  type="text"
                  id="signup-username"
                  class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none transition-all duration-300 input-focus-effect bg-white bg-opacity-70"
                  placeholder="Choose a username"
                  pattern="[a-z0-9]+"
                  title="Only lowercase letters (a-z) and numbers (0-9) are allowed"
                  required
                />
                <button
                  type="button"
                  onclick="generateRandomUsername()"
                  class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700 transition-colors duration-200"
                  title="Generate random username"
                >
                  <i class="fas fa-redo-alt text-sm"></i>
                </button>
              </div>
              <p class="text-xs text-gray-500 mt-1">Only lowercase letters and numbers, no spaces or special characters</p>
            </div>

            <div>
              <label for="signup-email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
              <input
                type="email"
                id="signup-email"
                class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none transition-all duration-300 input-focus-effect bg-white bg-opacity-70"
                placeholder="you@example.com"
                required
              />
            </div>

            <div>
              <label for="signup-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
              <div class="relative">
                <input
                  type="password"
                  id="signup-password"
                  class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none transition-all duration-300 input-focus-effect bg-white bg-opacity-70 pr-10"
                  placeholder="••••••••"
                  minlength="6"
                  required
                />
                <button
                  type="button"
                  class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700 transition-colors duration-200"
                  onclick="togglePasswordVisibility('signup')"
                >
                  <i id="signup-password-icon" class="fas fa-eye-slash"></i>
                </button>
              </div>
              <p class="text-xs text-gray-500 mt-1">Minimum 6 characters</p>
            </div>

            <button
              type="submit"
              class="w-full py-3 px-6 bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 text-white font-medium rounded-xl transition-all duration-300 btn-hover-effect relative overflow-hidden"
              id="signup-btn"
            >
              <span id="signup-btn-text">Create Account</span>
              <svg id="signup-spinner" class="hidden w-5 h-5 ml-2 text-white animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
            </button>
          </form>

          <div id="signup-error-message" class="mt-4 text-sm text-red-500 text-center animate-fade-in"></div>
          <div id="signup-success-message" class="mt-4 text-sm text-emerald-500 text-center animate-fade-in"></div>

          <div class="mt-6 text-center text-sm text-gray-600 animate-slide-up opacity-0">
            Already have an account?
            <button onclick="flipToSignIn()" class="text-emerald-600 font-medium hover:underline focus:outline-none transition-colors duration-200">
              Sign In Now
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
  // Animation and Card Flip Logic
  let isFlipped = false;
  const card = document.getElementById('authCard');
  const signInDot = document.getElementById('dot-signin');
  const signUpDot = document.getElementById('dot-signup');
  const signInFace = document.getElementById('signInFace');
  const signUpFace = document.getElementById('signUpFace');

  // Add ripple effect to buttons
  document.querySelectorAll('button').forEach(button => {
    button.addEventListener('click', function(e) {
      const rect = this.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      
      const ripple = document.createElement('span');
      ripple.classList.add('ripple');
      ripple.style.left = `${x}px`;
      ripple.style.top = `${y}px`;
      
      this.appendChild(ripple);
      
      setTimeout(() => {
        ripple.remove();
      }, 600);
    });
  });

  // Measure and set initial heights
  function setCardHeights() {
    const signInHeight = signInFace.scrollHeight;
    const signUpHeight = signUpFace.scrollHeight;
    signInFace.style.height = `${signInHeight}px`;
    signUpFace.style.height = `${signUpHeight}px`;
    card.style.height = `${isFlipped ? signUpHeight : signInHeight}px`;
  }

  // Initialize heights and animations on load
  document.addEventListener('DOMContentLoaded', () => {
    setCardHeights();
    
    // Animate elements with delay
    const slideUpElements = document.querySelectorAll('.animate-slide-up');
    slideUpElements.forEach((el, index) => {
      setTimeout(() => {
        el.style.opacity = '1';
        el.style.filter = 'blur(0)';
      }, 50 + (index * 50));
    });
  });

  window.flipToSignUp = () => {
    if (isFlipped) return;
    flipCard();
  };

  window.flipToSignIn = () => {
    if (!isFlipped) return;
    flipCard();
  };

  function flipCard() {
    isFlipped = !isFlipped;
    
    // Get current heights
    const currentHeight = isFlipped ? signInFace.scrollHeight : signUpFace.scrollHeight;
    const targetHeight = isFlipped ? signUpFace.scrollHeight : signInFace.scrollHeight;
    
    // Animate height change
    card.style.height = `${currentHeight}px`;
    setTimeout(() => {
      card.style.height = `${targetHeight}px`;
    }, 10);
    
    // Apply flip class after a slight delay to allow height measurement
    setTimeout(() => {
      card.classList.toggle('flipped');
      
      // Update dot indicators
      if (isFlipped) {
        signInDot.classList.replace('bg-emerald-500', 'bg-gray-300');
        signUpDot.classList.replace('bg-gray-300', 'bg-emerald-500');
      } else {
        signInDot.classList.replace('bg-gray-300', 'bg-emerald-500');
        signUpDot.classList.replace('bg-emerald-500', 'bg-gray-300');
      }
    }, 50);
  }

  // Touch swipe handling with improved animation
  let touchStartX = 0;
  let touchEndX = 0;
  let touchStartY = 0;
  const cardContainer = document.getElementById('cardContainer');
  const SWIPE_THRESHOLD = 50;
  const VERTICAL_THRESHOLD = 30;

  cardContainer.addEventListener('touchstart', (e) => {
    touchStartX = e.changedTouches[0].screenX;
    touchStartY = e.changedTouches[0].screenY;
  }, {passive: true});

  cardContainer.addEventListener('touchmove', (e) => {
    // Prevent scrolling if we're swiping horizontally
    const xDiff = Math.abs(e.changedTouches[0].screenX - touchStartX);
    const yDiff = Math.abs(e.changedTouches[0].screenY - touchStartY);
    
    if (xDiff > yDiff && xDiff > 10) {
      e.preventDefault();
    }
  }, {passive: false});

  cardContainer.addEventListener('touchend', (e) => {
    touchEndX = e.changedTouches[0].screenX;
    const touchEndY = e.changedTouches[0].screenY;
    
    // Check if it's mostly horizontal swipe
    if (Math.abs(touchEndY - touchStartY) < VERTICAL_THRESHOLD) {
      handleSwipe();
    }
  }, {passive: true});

  function handleSwipe() {
    const xDiff = touchEndX - touchStartX;
    
    if (xDiff < -SWIPE_THRESHOLD && !isFlipped) {
      // Swipe left to sign up
      signInFace.classList.add('swipe-left');
      setTimeout(() => {
        signInFace.classList.remove('swipe-left');
        flipToSignUp();
      }, 300);
    } else if (xDiff > SWIPE_THRESHOLD && isFlipped) {
      // Swipe right to sign in
      signUpFace.classList.add('swipe-right');
      setTimeout(() => {
        signUpFace.classList.remove('swipe-right');
        flipToSignIn();
      }, 300);
    }
  }

  // Generate random username
  function generateRandomUsername() {
    const now = new Date();
    const datePart = `${now.getDate()}${now.getMonth()+1}${now.getFullYear().toString().slice(-2)}`;
    const randomPart = Math.floor(10000 + Math.random() * 90000);
    const username = `user${datePart}${randomPart}`;
    document.getElementById('signup-username').value = username;
    return username;
  }

  // Set default username when page loads
  generateRandomUsername();

  // Toggle password visibility
  window.togglePasswordVisibility = (type) => {
    const passwordInput = document.getElementById(`${type}-password`);
    const passwordIcon = document.getElementById(`${type}-password-icon`);

    if (passwordInput.type === 'password') {
      passwordInput.type = 'text';
      passwordIcon.classList.remove('fa-eye-slash');
      passwordIcon.classList.add('fa-eye');
    } else {
      passwordInput.type = 'password';
      passwordIcon.classList.remove('fa-eye');
      passwordIcon.classList.add('fa-eye-slash');
    }
  }

  // Add username input validation
  document.getElementById('signup-username').addEventListener('input', function(e) {
    this.value = this.value.toLowerCase().replace(/[^a-z0-9]/g, '');
  });

  // Verification Dialog Functions
  let countdownTimer;
  window.showVerificationDialog = (email) => {
    const dialog = document.getElementById('verificationDialog');
    const sentEmail = document.getElementById('sentEmail');
    const countdownElement = document.getElementById('countdown');
    const countdownBar = document.getElementById('countdown-bar');

    sentEmail.textContent = email;
    dialog.classList.remove('hidden');

    let seconds = 30;
    countdownTimer = setInterval(() => {
      seconds--;
      countdownElement.textContent = seconds;
      countdownBar.style.width = `${(seconds / 30) * 100}%`;
      if(seconds <= 0) redirectToSignIn();
    }, 1000);
  }

  window.redirectToSignIn = () => {
    clearInterval(countdownTimer);
    document.getElementById('verificationDialog').classList.add('hidden');
    flipToSignIn();
  }

  // Sign Up Form Submission
  document.getElementById('signupForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const username = document.getElementById('signup-username').value;
    const usernameRegex = /^[a-z0-9]+$/;
    if (!usernameRegex.test(username)) {
      document.getElementById('signup-error-message').textContent = 'Username can only contain lowercase letters and numbers';
      return;
    }

    await signup();
  });

  window.signup = async () => {
    const username = document.getElementById('signup-username').value;
    const email = document.getElementById('signup-email').value;
    const password = document.getElementById('signup-password').value;
    const errorDiv = document.getElementById('signup-error-message');
    const successDiv = document.getElementById('signup-success-message');
    const signupBtn = document.getElementById('signup-btn');
    const btnText = document.getElementById('signup-btn-text');
    const btnSpinner = document.getElementById('signup-spinner');

    errorDiv.textContent = '';
    successDiv.textContent = '';

    // Show loading state
    signupBtn.disabled = true;
    btnText.classList.add('hidden');
    btnSpinner.classList.remove('hidden');

    // Simulate API call
    setTimeout(async () => {
      try {
        // In a real app, you would call your authentication service here
        // For demo purposes, we'll just show the verification dialog
        showVerificationDialog(email);
        
        successDiv.textContent = 'Account created successfully!';
      } catch (error) {
        errorDiv.textContent = error.message || 'An error occurred during signup';
        signupBtn.disabled = false;
        btnText.classList.remove('hidden');
        btnSpinner.classList.add('hidden');
      }
    }, 1500);
  }

  // Sign In Functions
  window.validateEmailInput = (input) => {
    input.value = input.value.toLowerCase().replace(/[^a-z0-9@.]/g, '');
  }

  window.login = async () => {
    const email = document.getElementById('signin-email').value;
    const password = document.getElementById('signin-password').value;
    const errorDiv = document.getElementById('signin-error-message');
    const btn = document.getElementById('login-btn');
    const btnText = document.getElementById('login-btn-text');
    const spinner = document.getElementById('login-spinner');

    btn.disabled = true;
    btnText.textContent = 'Signing in...';
    spinner.classList.remove('hidden');
    errorDiv.textContent = '';

    // Simulate API call
    setTimeout(() => {
      if (email && password) {
        // In a real app, you would authenticate here
        // For demo, we'll just show a success message
        errorDiv.textContent = '';
        // window.location.href = "messages.html";
        alert('Login successful! (Demo only)');
      } else {
        errorDiv.textContent = 'Please enter both email and password';
      }
      
      btn.disabled = false;
      btnText.textContent = 'Sign In';
      spinner.classList.add('hidden');
    }, 1500);
  }

  // Google Login
  window.googleLogin = async () => {
    try {
      // In a real app, you would call your Google auth service here
      // For demo, we'll just show an alert
      alert('Google authentication would happen here in a real app');
      // window.location.href = "messages.html";
    } catch (error) {
      const errorDiv = isFlipped 
        ? document.getElementById('signup-error-message')
        : document.getElementById('signin-error-message');
      errorDiv.textContent = error.message || 'Google authentication failed';
    }
  }
  </script>
</body>
</html>